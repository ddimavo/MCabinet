<xf:title>–ì–∞–ª–µ—Ä–µ—è —Å–∫–∏–Ω–æ–≤</xf:title>

<xf:css>
.gallery-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}
.gallery-tabs {
    display: flex;
    border-bottom: 2px solid var(--mc-border);
    margin-bottom: 30px;
}
.gallery-tab {
    padding: 15px 30px;
    cursor: pointer;
    border: none;
    background: none;
    color: var(--mc-text-secondary);
    font-weight: 500;
    transition: all 0.3s ease;
    position: relative;
}
.gallery-tab.active {
    color: var(--mc-primary);
}
.gallery-tab.active::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--mc-primary);
}
.gallery-tab:hover {
    color: var(--mc-primary);
}
.gallery-content {
    display: none;
}
.gallery-content.active {
    display: block;
}
.gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}
.gallery-item {
    background: var(--mc-bg-card);
    border-radius: 12px;
    overflow: hidden;
    transition: all 0.3s ease;
    border: 1px solid var(--mc-border);
    position: relative;
}
.gallery-item:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}
.gallery-item-image {
    width: 100%;
    height: 150px;
    background: linear-gradient(45deg, #f5f5f5 25%, transparent 25%, transparent 75%, #f5f5f5 75%),
                linear-gradient(45deg, #f5f5f5 25%, transparent 25%, transparent 75%, #f5f5f5 75%);
    background-size: 20px 20px;
    background-position: 0 0, 10px 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 10px;
}
.gallery-item-image img {
    max-width: 100%;
    max-height: 130px;
    image-rendering: pixelated;
}
.gallery-item-info {
    padding: 12px;
    border-top: 1px solid var(--mc-border);
}
.gallery-item-name {
    font-weight: 600;
    color: var(--mc-text-primary);
    margin-bottom: 5px;
    font-size: 13px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.gallery-item-author {
    color: var(--mc-text-secondary);
    font-size: 11px;
}
.gallery-item-stats {
    display: flex;
    gap: 10px;
    margin-top: 8px;
    font-size: 11px;
    color: var(--mc-text-muted);
}
.gallery-item-actions {
    display: flex;
    gap: 8px;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid var(--mc-border-light);
}
.action-btn {
    flex: 1;
    padding: 8px 12px;
    border: none;
    border-radius: 8px;
    font-size: 11px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    text-align: center;
}
.action-btn--primary {
    background: linear-gradient(135deg, var(--mc-primary) 0%, var(--mc-secondary) 100%);
    color: white;
}
.action-btn--primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}
.action-btn--primary:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none !important;
}
.action-btn--secondary {
    background: transparent;
    color: var(--mc-text-muted);
    border: 1px solid var(--mc-border);
}
.action-btn--secondary:hover {
    background: #e53e3e;
    color: white;
    border-color: #e53e3e;
}
.gallery-actions {
    position: absolute;
    top: 8px;
    right: 8px;
    display: flex;
    gap: 5px;
    opacity: 0;
    transition: opacity 0.3s ease;
}
.gallery-item:hover .gallery-actions {
    opacity: 1;
}
.gallery-action-btn {
    width: 28px;
    height: 28px;
    border-radius: 6px;
    border: none;
    background: var(--mc-bg-card);
    color: var(--mc-text-primary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    transition: all 0.2s ease;
}
.gallery-action-btn:hover {
    background: var(--mc-primary);
    color: white;
}
.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--mc-text-muted);
}
.empty-state-icon {
    font-size: 48px;
    margin-bottom: 15px;
    opacity: 0.5;
}
.pagination {
    margin-top: 30px;
}
.catalog-badge {
    position: absolute;
    top: 8px;
    left: 8px;
    background: var(--mc-primary);
    color: white;
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 10px;
    font-weight: 600;
}
</xf:css>

<div class="gallery-container">
    <div class="gallery-tabs">
        <button class="gallery-tab active" data-tab="catalog">–ö–∞—Ç–∞–ª–æ–≥</button>
        <button class="gallery-tab" data-tab="my-skins">–ú–æ–∏ —Å–∫–∏–Ω—ã</button>
    </div>

    <!-- –ö–∞—Ç–∞–ª–æ–≥ —Å–∫–∏–Ω–æ–≤ -->
    <div class="gallery-content active" id="catalog-content">
        <xf:if is="$catalogSkins is not empty">
            <div class="gallery-grid">
                <xf:foreach loop="$catalogSkins" value="$skin">
                    <div class="gallery-item" data-skin-id="{$skin.skin_id}">
                        <div class="gallery-item-image">
                            <img src="{{ link('skins/preview', null, {'filename': $skin.skin_texture, 'type': 'full', 'size': 150}) }}" 
                                 alt="{$skin.skin_name}"
                                 loading="lazy"
                                 onerror="this.src='{{ link('skins/preview', null, {'type': 'full', 'size': 150}) }}'">
                        </div>
                        <div class="gallery-item-info">
                            <div class="gallery-item-name">{$skin.skin_name}</div>
                            <div class="gallery-item-author">@{$skin.User.username}</div>
                            <div class="gallery-item-stats">
                                <span>üëÅÔ∏è {$skin.view_count}</span>
                                <span>‚ù§Ô∏è {$skin.like_count}</span>
                            </div>
                            
                            <div class="gallery-item-actions">
                                <button class="action-btn action-btn--primary" 
                                        data-xf-click="apply-skin" 
                                        data-skin-id="{$skin.skin_id}"
                                        data-url="{{ link('mcabinet/gallery/apply-skin', $skin) }}">
                                    ‚ö° –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                                </button>
                                
                                <button class="action-btn action-btn--secondary" 
                                        data-xf-click="report-skin" 
                                        data-skin-id="{$skin.skin_id}"
                                        data-url="{{ link('mcabinet/gallery/report', $skin) }}">
                                    üö© –ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è
                                </button>
                            </div>
                        </div>
                    </div>
                </xf:foreach>
            </div>
            
            <xf:if is="$totalSkins > $perPage">
                <div class="pagination">
                    <xf:pagination page="{$page}" perpage="{$perPage}" total="{$totalSkins}" 
                                  link="mcabinet/gallery" />
                </div>
            </xf:if>
        <xf:else />
            <div class="empty-state">
                <div class="empty-state-icon">üé®</div>
                <h3>–ö–∞—Ç–∞–ª–æ–≥ –ø—É—Å—Ç</h3>
                <p>–ó–¥–µ—Å—å –ø–æ–∫–∞ –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ —Å–∫–∏–Ω–∞</p>
                <xf:if is="$canUploadToCatalog">
                    <a href="{{ link('mcabinet/upload-skin') }}" class="button button--primary">
                        –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–≤—ã–π —Å–∫–∏–Ω
                    </a>
                </xf:if>
            </div>
        </xf:if>
    </div>

    <!-- –ú–æ–∏ —Å–∫–∏–Ω—ã -->
    <div class="gallery-content" id="my-skins-content">
        <xf:if is="$mySkins is not empty">
            <div class="gallery-grid">
                <xf:foreach loop="$mySkins" value="$skin">
                    <div class="gallery-item">
                        <xf:if is="$skin.is_in_catalog">
                            <div class="catalog-badge">–í –∫–∞—Ç–∞–ª–æ–≥–µ</div>
                        </xf:if>
                        <div class="gallery-item-image">
                            <img src="{{ link('skins/preview', null, {'filename': $skin.skin_texture, 'type': 'full', 'size': 150}) }}" 
                                 alt="{$skin.skin_name}"
                                 loading="lazy"
                                 onerror="this.src='{{ link('skins/preview', null, {'type': 'full', 'size': 150}) }}'">
                        </div>
                        <div class="gallery-item-info">
                            <div class="gallery-item-name">{$skin.skin_name}</div>
                            <div class="gallery-item-stats">
                                <span>üìÖ <xf:date time="$skin.upload_date" /></span>
                                <xf:if is="$skin.is_in_catalog">
                                    <span>üëÅÔ∏è {$skin.view_count}</span>
                                </xf:if>
                            </div>
                            
                            <div class="gallery-item-actions">
                                <button class="action-btn action-btn--primary" 
                                        data-xf-click="apply-skin" 
                                        data-skin-id="{$skin.skin_id}"
                                        data-url="{{ link('mcabinet/gallery/apply-skin', $skin) }}">
                                    ‚ö° –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                                </button>
                                
                                <xf:if is="!$skin.is_in_catalog and $canUploadToCatalog">
                                    <a href="{{ link('mcabinet/gallery/add-to-catalog', $skin) }}" 
                                       class="action-btn action-btn--secondary">
                                        ‚≠ê –í –∫–∞—Ç–∞–ª–æ–≥
                                    </a>
                                </xf:if>
                            </div>
                        </div>
                        <div class="gallery-actions">
                            <xf:if is="!$skin.is_in_catalog and $canUploadToCatalog">
                                <a href="{{ link('mcabinet/gallery/add-to-catalog', $skin) }}" 
                                   class="gallery-action-btn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–∞—Ç–∞–ª–æ–≥">‚≠ê</a>
                            </xf:if>
                            <a href="{{ link('mcabinet/remove-skin', $skin) }}" 
                               class="gallery-action-btn" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</a>
                        </div>
                    </div>
                </xf:foreach>
            </div>
        <xf:else />
            <div class="empty-state">
                <div class="empty-state-icon">üñºÔ∏è</div>
                <h3>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–∫–∏–Ω–æ–≤</h3>
                <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π —Å–∫–∏–Ω —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å</p>
                <a href="{{ link('mcabinet/upload-skin') }}" class="button button--primary">
                    –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–∫–∏–Ω
                </a>
            </div>
        </xf:if>
    </div>
</div>

<xf:js>
$(document).ready(function() {
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏
    $('.gallery-tab').on('click', function() {
        $('.gallery-tab').removeClass('active');
        $(this).addClass('active');
        
        $('.gallery-content').removeClass('active');
        $('#' + $(this).data('tab') + '-content').addClass('active');
    });
    
    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∫–∏–Ω–∞
    $('[data-xf-click="apply-skin"]').on('click', function(e) {
        e.preventDefault();
        
        const button = $(this);
        const skinId = button.data('skin-id');
        const url = button.data('url');
        
        button.prop('disabled', true).text('–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º...');
        
        XF.ajax('post', url, {}, function(data) {
            if (data.status === 'ok') {
                XF.alert(data.message);
                button.text('‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
            } else {
                button.prop('disabled', false).text('‚ö° –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å');
                XF.alert(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–∫–∏–Ω–∞');
            }
        }).fail(function() {
            button.prop('disabled', false).text('‚ö° –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å');
            XF.alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
        });
    });
    
    // –ñ–∞–ª–æ–±–∞ –Ω–∞ —Å–∫–∏–Ω
    $('[data-xf-click="report-skin"]').on('click', function(e) {
        e.preventDefault();
        
        const skinId = $(this).data('skin-id');
        const url = $(this).data('url');
        
        XF.ajax('get', url, {}, function(data) {
            XF.showOverlay(data.html, {
                attributes: {
                    class: 'overlay--skinReport'
                }
            });
        });
    });
});
</xf:js>